# ====================================
# CORE CONFIGURATION
# ====================================

# Database (Required - Neon Postgres)
DATABASE_URL="postgresql://user:password@ep-example-123456.us-east-2.aws.neon.tech/database?sslmode=require"

# Test Database (Optional - prevents test suite from clearing dev data)
# If not set, tests will use DATABASE_URL (NOT RECOMMENDED for production databases)
# Create a separate test database or use Docker for test isolation
TEST_DATABASE_URL=postgresql://test:test@localhost:5432/test

# Address Generation (Deterministic)
# Used for generating Ethereum addresses from user IDs
PLATFORM_SALT=communique-voter-protocol-2024
CHAIN_ID=534351  # Scroll Sepolia testnet

# Congressional Web Contact API (Required)
CWC_API_BASE_URL=https://soapbox.senate.gov/api
CWC_API_KEY=your-cwc-api-key
CWC_CAMPAIGN_ID=communique-2025

# House CWC Integration (GCP Proxy)
GCP_PROXY_URL=http://34.171.151.252:8080
GCP_PROXY_AUTH_TOKEN=your-gcp-proxy-auth-token

# CWC Delivery Agent Configuration (CommuniquÃ© PBC)
CWC_DELIVERY_AGENT_ID=COMMUNIQUE_PBC
CWC_DELIVERY_AGENT_NAME="CommuniquÃ© PBC"
CWC_DELIVERY_AGENT_CONTACT=hello@communi.email
CWC_DELIVERY_AGENT_ACKNOWLEDGEMENT_EMAIL=noreply@communi.email
CWC_DELIVERY_AGENT_ACK=Y

# CommuniquÃ© API
COMMUNIQUE_API_URL=https://api.communi.email
COMMUNIQUE_API_KEY=your-communique-api-key
COMMUNIQUE_WEBHOOK_SECRET=your-webhook-secret
COMMUNIQUE_MAIL_SERVER_KEY=your-mail-server-key

# ====================================
# VOTER PROTOCOL INTEGRATION (NEAR + Scroll Testnet)
# ====================================

# NEAR Testnet Configuration
NEAR_NETWORK_ID=testnet
NEAR_NODE_URL=https://rpc.testnet.near.org
NEAR_MPC_CONTRACT=v1.signer.testnet

# Web3Auth (OAuth â†’ MPC Wallet)
WEB3AUTH_CLIENT_ID=your-web3auth-client-id
WEB3AUTH_NETWORK=testnet

# ðŸ”’ PRIVACY: Account ID Generation
# CRITICAL: Generate a random 256-bit salt and keep it secret
# This prevents linking account IDs to real identities
# Command to generate: openssl rand -hex 32
NEAR_ACCOUNT_SALT=your-random-256-bit-salt-here-keep-secret

# Scroll Sepolia Testnet
SCROLL_RPC_URL=https://sepolia-rpc.scroll.io
SCROLL_CHAIN_ID=534351
SCROLL_EXPLORER=https://sepolia.scrollscan.com

# Smart Contract Addresses (Deploy to Scroll Sepolia)
VOTER_TOKEN_ADDRESS=0x... # VOTERToken ERC20
DISTRICT_GATE_ADDRESS=0x... # ZK proof verifier
REPUTATION_REGISTRY_ADDRESS=0x... # ERC-8004 reputation

# Certification Settings
ENABLE_CERTIFICATION=true
ENABLE_VOTER_CERTIFICATION=true

# Direct Blockchain Certification (Optional - Manual Contracts)
RPC_URL=http://localhost:8545
CERTIFIER_PRIVATE_KEY=your-private-key-here

# ====================================
# AGENT CONFIGURATION
# ====================================

# Multi-Agent Consensus APIs (REQUIRED for moderation)
OPENAI_API_KEY=your-openai-api-key-here  # For FREE moderation API + GPT-5
GEMINI_API_KEY=your-gemini-api-key-here  # For Gemini 2.5 Flash-Lite ($0.10/1M) + Embeddings (FREE tier!)
ANTHROPIC_API_KEY=your-anthropic-api-key  # For Claude 3.5 Haiku (tie-breaker)

# Gemini API Key (Get from: https://aistudio.google.com/apikey)
# - Used for: Text embeddings (gemini-embedding-001) + Agent moderation
# - FREE tier: Unlimited requests in Google AI Studio
# - Paid tier: $0.15 per 1M tokens (embeddings), $0.10 per 1M tokens (moderation)
# - Key format: AIza... (40 characters)

# ====================================
# GEOGRAPHIC SCOPE EXTRACTION (Phase 2)
# ====================================

# Census Bureau Geocoding API (FREE, unlimited, US-only)
# Provider: US Census Bureau (https://geocoding.geo.census.gov/)
# Cost: $0/month (completely free, no API key required)
# Coverage: 100% US addresses + congressional/state legislative districts
# Note: No API key needed - Census Bureau API is public
# Caching: Simple in-memory cache (no Redis needed)

# ====================================
# VOTER PROTOCOL API (Required for Reputation)
# ====================================

# voter-protocol API URL (Cloudflare Workers deployment)
# Production: https://reputation.voter.workers.dev
# Development: http://localhost:8787 (wrangler dev)
VOTER_PROTOCOL_API_URL=https://reputation.voter.workers.dev

# voter-protocol API Authentication
# Generate with: openssl rand -hex 32
VOTER_API_KEY=your-voter-protocol-api-key-here-keep-secret

# Moderation Settings
DAILY_COST_LIMIT=50  # Daily AI cost limit in USD
MONTHLY_COST_LIMIT=500  # Monthly AI cost limit in USD
CONSENSUS_TYPE=multi_agent  # 'multi_agent' or 'single' (fallback)

# ====================================
# BLOCKCHAIN CONFIGURATION (Optional)
# ====================================

# ðŸ”’ SECURITY: NO PRIVATE KEYS ON SERVER
# All transaction signing happens CLIENT-SIDE with user passkeys.
# The server is READ-ONLY for blockchain state queries.

# Scroll zkEVM RPC (Ethereum L2 settlement)
SCROLL_RPC_URL=https://rpc.scroll.io

# Contract Addresses (READ-ONLY)
VOTER_REGISTRY_ADDRESS=0x...
VOTER_TOKEN_ADDRESS=0x...
COMMUNIQUE_CORE_ADDRESS=0x...
AGENT_CONSENSUS_ADDRESS=0x...

# ====================================
# IDENTITY VERIFICATION (Phase 1A)
# ====================================

# ðŸ”’ CRITICAL: Identity Hash Salt (Sybil Resistance)
# Generate with: openssl rand -hex 32
# NEVER regenerate in production (requires data migration)
IDENTITY_HASH_SALT=your-64-char-hex-salt-here-keep-secret-never-regenerate

# ðŸ”’ IP Hash Salt (Fraud Detection)
# Generate with: openssl rand -hex 32
# Rotates daily (can be regenerated safely)
IP_HASH_SALT=your-64-char-hex-salt-here-keep-secret-safe-to-regenerate

# self.xyz SDK Configuration (FREE tier - no API key required)
# self.xyz uses on-chain verification, not API keys
NEXT_PUBLIC_SELF_APP_NAME=CommuniquÃ©
NEXT_PUBLIC_SELF_SCOPE=communique-congressional
NEXT_PUBLIC_SELF_ENDPOINT=https://communi.email/api/identity/verify
SELF_MOCK_PASSPORT=false  # Set to 'true' for development/testing

# Didit.me SDK Configuration (FREE tier)
DIDIT_API_KEY=your-didit-api-key-here
DIDIT_WORKFLOW_ID=your-didit-workflow-id-here
DIDIT_WEBHOOK_SECRET=your-didit-webhook-secret-here  # For HMAC signature verification

# ====================================
# AUTHENTICATION & SECURITY
# ====================================

# Email Verification & JWT
EMAIL_VERIFICATION_SECRET=your-email-verification-secret
JWT_SECRET=your-jwt-secret-here

# Domain Control
ALLOWED_DOMAINS=communi.email,communique.app
DEFAULT_FROM_DOMAIN=communi.email

# ====================================
# FEATURE FLAGS (Optional)
# ====================================

# Enable beta features
ENABLE_BETA=false

# Enable challenge markets
ENABLE_CHALLENGE_MARKETS=true

# Enable supply optimization
ENABLE_SUPPLY_OPTIMIZATION=true

# ====================================
# MONITORING & NOTIFICATIONS (Optional)
# ====================================

# Slack Notifications
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...
SLACK_CHANNEL=#deployments

# Sentry / Logging
SENTRY_DSN=your-sentry-dsn
LOG_LEVEL=info

# ====================================
# EMAIL INFRASTRUCTURE (SMTP)
# ====================================
SMTP_PORT=587
SMTP_HOST=email-smtp.us-east-1.amazonaws.com
SMTP_SECURE=true
SMTP_AUTH_USER=your-smtp-user
SMTP_AUTH_PASS=your-smtp-password

# ====================================
# DEVELOPMENT SETTINGS
# ====================================

# Node Environment
NODE_ENV=development

# Server Configuration
PORT=5173
HOST=localhost

# Debug Settings
DEBUG=communique:*
LOG_LEVEL=info

# ====================================
# TEE CONFIGURATION (Week 13-14)
# ====================================

# ðŸ”’ CRITICAL: XChaCha20-Poly1305 Encryption
# Generate with: openssl rand -hex 32
# NEVER regenerate in production (requires key migration)
ENCRYPTION_KEY=your-64-char-hex-encryption-key-here-keep-secret-never-regenerate

# TEE Provider Selection (aws | gcp | azure | mock)
# PRIMARY: AWS Nitro Enclaves (ARM Graviton, no Intel ME/AMD PSP, independently audited)
TEE_PROVIDER=aws

# ====================================
# AWS NITRO ENCLAVES (PRIMARY - Phase 1)
# ====================================
#
# Security advantages:
# - No Intel ME or AMD PSP (ARM Graviton architecture)
# - Hypervisor-based isolation (trust AWS, not CPU vendor)
# - Independently audited (August 2025)
# - Open-source Nitro components for inspection
# - Cost: 15-30% cheaper than GCP ($55-60/month vs $60-85/month)
# - FREE tier: 750 hrs/month on t4g.small through Dec 2025
#
# Security caveat: While AWS Nitro avoids x86 management engines,
# absolute certainty about NSA backdoors is impossible. ARM architecture
# + auditable components reduce but don't eliminate state-actor risk.

# AWS Region (us-east-1 recommended for cost + CWC proximity)
AWS_REGION=us-east-1

# AWS Account ID (12-digit account number)
AWS_ACCOUNT_ID=123456789012

# AWS Credentials (optional if using IAM roles)
# AWS_ACCESS_KEY_ID=your-access-key-id
# AWS_SECRET_ACCESS_KEY=your-secret-access-key

# Nitro Enclave Instance Type (ARM Graviton with Nitro Enclaves support)
# Options: c6g.large (2vCPU, 4GB), c6g.xlarge (4vCPU, 8GB), c7g.large, m6g.large, r6g.large
# FREE tier: t4g.small (2vCPU, 2GB) - 750 hrs/month through Dec 2025
AWS_NITRO_INSTANCE_TYPE=c6g.large

# VPC Configuration
AWS_VPC_ID=vpc-0123456789abcdef0
AWS_SUBNET_ID=subnet-0123456789abcdef0
AWS_SECURITY_GROUP_IDS=sg-0123456789abcdef0,sg-0123456789abcdef1

# IAM Instance Profile (for EC2 parent instance)
AWS_IAM_INSTANCE_PROFILE=CommuniqueTEEInstanceProfile

# Enclave Image Storage
AWS_ENCLAVE_BUCKET=communique-nitro-enclaves
AWS_ENCLAVE_IMAGE_KEY=enclaves/communique-tee.eif

# Nitro Enclave Configuration
AWS_NITRO_ENCLAVE_CID=16  # Context ID for vsock communication
AWS_NITRO_ENCLAVE_PORT=5000  # Vsock port for enclave communication
AWS_NITRO_VSOCK_PROXY_PORT=8080  # Parent instance proxy port (external access)

# TEE Container Configuration (ECR)
TEE_CONTAINER_IMAGE=123456789012.dkr.ecr.us-east-1.amazonaws.com/communique-tee:latest
TEE_CONTAINER_DIGEST=sha256:...  # Generated after building container

# TEE Instance Configuration
TEE_INSTANCE_CPU=2  # CPU cores allocated to enclave
TEE_INSTANCE_MEMORY_GB=4  # Memory allocated to enclave (in GB)
TEE_ENDPOINT=https://tee.communi.email  # Public TEE endpoint

# TEE Security Settings
TEE_ENABLE_ATTESTATION_VERIFICATION=true  # Verify attestation tokens (REQUIRED in production)
TEE_EXPECTED_CODE_HASH=sha256:...  # Expected container image digest (updated after deployment)
TEE_MAX_PAYLOAD_SIZE_MB=10  # Maximum encrypted payload size (default: 10MB)

# TEE Monitoring
TEE_HEALTH_CHECK_INTERVAL_SECONDS=30  # Health check frequency (default: 30s)
TEE_METRICS_ENDPOINT=http://localhost:8080/metrics  # Prometheus metrics endpoint
